[toc]
***

# 背景

## kpi

1. 10月30号完成通信库的适配开发，为平板侧提供稳定、完整的轮式机器人操作API接口。
2. 10月30号完成通信库的适配开发，为GUI侧提供稳定、完整的轮式机器人操作API接口。
3. 10月30完成上位机服务程序的改造，稳定支持双臂机器人的任务链处理及状态/报警信息订阅。

## 10 月份工作总结

### 10 月第一周

1.  **10.06 - 10.08** - 国庆节放假。

2.  服务端代码优化
    - **功能解耦**：实现了对 `robot_interfaces` 包的可选依赖。现在可以通过 `colcon` 或 `cmake` 编译时添加 `-DENABLE_ROBOT_INTERFACES=1` 参数来启用相关功能，否则默认不编译，方便在不同环境下部署。
    - **消除编译告警**：解决了包括成员变量声明与初始化顺序不一致、头文件中静态函数未使用、结构体成员未初始化等多类编译告。

### 10 月第二周

1.  任务链新增“条件控制”特性：
    - 完成了该特性的方案设计、后端编码和自测。
    - 已将代码上库，并同步给前端进行开发，联调准备。

2.  任务链新增“相机拍照”动作：
    - 完成了双臂机器人相机拍照动作的后端开发与自测。
    - 代码已上库，并同步给前端开发人员。

3.  机器人操作模式优化：
    - 修改了 `set_do`（设置数字输出）操作的模式限制，从仅允许“手动模式”放宽至“示教模式”和“手动模式”下均可操作，提升了易用性。


### 10 月第三周

1. 双臂机器人联调
    - 成功完成了模拟场景下的双臂机器人夹取箱子的联调测试。

2. 任务链特性开发与优化
    - 新增 `set_di` API：为了方便在没有 PLC 环境下的独立测试，在 GUI 侧新增了 `set_di` 接口及其处理程序，用于模拟和触发任务链 `if` 条件块中的 `di` 条件。
    - 扩展 `if` 条件块功能：任务链的 `if` 条件控制块新增了对 `do` 条件的支持，增强了任务链的逻辑判断能力。

### 10 月第四周

1. 双臂机器人研发
    - 完成了双臂机器人任务中，动作并发执行功能的测试。
    - 对任务链中的边动作（非阻塞动作）与节点动作（阻塞动作）进行了区分和联调测试，确保了其执行逻辑的正确性。

2. QCL 异步通信库问题排查与优化
    - Core 问题定位与修复：定位并解决了陈工反馈的 `qcl` 库因多线程并发访问 `map` 对象导致的程序崩溃问题。通过对共享资源增加互斥锁，保障了线程安全。
    - 代码健壮性与性能提升：
        - 通过将互斥锁移入函数内部，实现了函数的自我保护，降低了调用方出错的风险。
        - 为点云通信引入了独立的处理器映射和锁，将不同信道的处理器管理分离开，消除了潜在的竞争风险。
        - 使用 `asio::steady_timer` 异步定时器替换了阻塞式的 `sleep_for`，提升了程序在异步回调中的性能和响应能力。

# 需求

从特性开发，代码优化，问题修复，联调 等角度整理10月份kpi完成情况

好的，这是根据您提供的 KPI 和工作总结，从四个角度整理的10月份 KPI 完成情况报告。

---

### **10月份 KPI 完成情况总结**

围绕10月份的关键绩效指标（KPI），本月的工作主要集中在双臂机器人任务链功能增强、服务端程序优化以及通信库的稳定性提升上，为后续的适配开发打下了坚实基础。各项工作进展顺利，具体完成情况如下：

#### **1. 特性开发 (Feature Development)**

本月在任务链和测试支持方面新增了多项核心功能，显著增强了双臂机器人的任务处理能力和系统的可测试性，直接支撑了 **KPI 3 (上位机服务程序改造)**。

*   **任务链逻辑控制增强**：
    *   新增“**条件控制 (if)**”特性，完成了从方案设计到后端开发的全流程，使任务链具备了逻辑判断能力。
    *   对 `if` 条件块功能进行扩展，新增了对 `do` 信号的判断支持，进一步丰富了任务链的条件触发机制。

*   **任务链动作扩展**：
    *   新增“**相机拍照**”动作，完成了双臂机器人场景下的后端开发与自测。
    *   为方便无 PLC 环境下的调试，在 GUI 侧增加了 `set_di` 模拟接口，用以触发和测试 `if` 条件。

*   **机器人操作模式优化**：
    *   放宽了 `set_do`（设置数字输出）的操作限制，从仅限“手动模式”扩展至“手动”和“示教”两种模式，提升了现场调试的易用性。

#### **2. 代码优化 (Code Optimization)**

为了提升服务端程序的健壮性、可维护性和性能，本月进行了多项代码层面的优化，为所有 KPI 目标的稳定性提供了保障。

*   **架构解耦与部署灵活性**：
    *   实现了 `robot_interfaces` 包的可选编译依赖。通过编译参数控制，使得服务端程序可以轻松地在不同环境下部署，降低了耦合度。

*   **代码质量提升**：
    *   系统性地消除了多类编译告警，规范了代码实现，提升了代码的整体质量和稳定性。

*   **异步通信性能优化 (针对 QCL 库)**：
    *   将阻塞式的 `sleep_for` 调用替换为非阻塞的 `asio::steady_timer` 异步定时器，提升了异步回调的执行性能和程序的整体响应能力。

#### **3. 问题修复 (Problem Fixing)**

本月成功定位并修复了通信库中的一个核心稳定性问题，保障了通信的可靠性，为 **KPI 1 和 KPI 2 (通信库适配开发)** 的稳定性要求奠定了基础。

*   **QCL 异步通信库 Core 问题修复**：
    *   **定位并解决线程安全问题**：精准定位到 `qcl` 库因多线程并发访问共享资源（`map` 对象）导致的程序崩溃（Core Dump）问题。
    *   **增加互斥锁保护**：通过引入互斥锁，对共享资源进行访问保护，彻底解决了该并发问题，确保了库的线程安全。
    *   **提升代码健壮性**：通过将锁的粒度细化并内聚到函数内部、分离不同信道的处理器管理等方式，进一步提升了代码的健壮性和可维护性，消除了潜在的竞争风险。

#### **4. 联调 (Joint Debugging & Integration Testing)**

通过联调测试，验证了双臂机器人核心功能的正确性和稳定性，确保了 **KPI 3** 的关键部分已准备就绪。

*   **双臂机器人场景联调**：
    *   成功完成了模拟场景下“**双臂机器人协同夹取箱子**”的联调测试，验证了任务链的端到端执行能力。

*   **任务链并发与时序逻辑验证**：
    *   对任务链中的**动作并发执行**功能进行了测试。
    *   完成了**边动作（非阻塞）**与**节点动作（阻塞）**的区分和联调测试，确保了复杂任务的时序逻辑按预期正确执行。

---
**总结**：截至目前，针对双臂机器人的上位机服务程序改造（**KPI 3**）已基本完成核心功能开发、优化和联调。通信库（QCL）的关键稳定性问题已解决，为接下来面向平板和GUI的适配开发（**KPI 1 & 2**）清除了障碍，整体进度符合预期。



# 对外

## kpi

1. 10月30号完成通信库的适配开发，为平板侧提供稳定、完整的轮式机器人操作API接口。

2. 10月30号完成通信库的适配开发，为GUI侧提供稳定、完整的轮式机器人操作API接口。

3. 10月30完成上位机服务程序的改造，稳定支持双臂机器人的任务链处理及状态/报警信息订阅。

## 10月份 KPI 完成情况总结

围绕10月份的关键绩效指标（KPI），本月的工作主要集中在双臂机器人任务链功能增强、服务端程序优化以及通信库的稳定性提升上，对于gui侧（刘工，奉工），web侧(陈工)，需要的功能提供了完整的支持，具体完成情况如下：

1. 特性开发
    -  新增 “条件控制 (if)” 特性，完成了从方案设计到后端开发的全流程，使任务链具备了逻辑判断能力。
    - 对 `if` 条件块功能进行扩展，新增了对 `do` 信号的判断支持，进一步丰富了任务链的条件触发机制。
    - 放宽了 `set_do`（设置数字输出）的操作限制，从仅限“手动模式”扩展至“手动”和“示教”两种模式。

2. 代码优化
    - 架构解耦与部署灵活性：实现了 `robot_interfaces` 包的可选编译依赖。通过编译参数控制，使得服务端程序可以轻松地在不同环境下部署，降低了耦合度。
    - 代码质量提升：系统性地消除了多类编译告警，规范了代码实现，提升了代码的整体质量和稳定性。
    - 异步通信性能优化：将阻塞式的 `sleep_for` 调用替换为非阻塞的 `asio::steady_timer` 异步定时器，提升了异步回调的执行性能和程序的整体响应能力。

3. QCL 异步通信库 Core 问题修复
    - 定位并解决线程安全问题：定位到 `qcl` 库因多线程并发访问共享资源（`map` 对象）导致的程序崩溃（Core Dump）问题。
    - 增加互斥锁保护：通过引入互斥锁，对共享资源进行访问保护，彻底解决了该并发问题，确保了库的线程安全。
    - 提升代码健壮性：通过将锁的粒度细化并内聚到函数内部、分离不同信道的处理器管理等方式，进一步提升了代码的健壮性和可维护性，消除了潜在的竞争风险。

4. 联调
    - 双臂机器人场景联调：成功完成了模拟场景下“双臂机器人协同夹取箱子”的联调测试，验证了任务链的端到端执行能力。
    - 任务链并发与时序逻辑验证：对任务链中的 ”动作并发执行“ 功能进行了测试。
        - 完成了 “边动作（非阻塞）“与”节点动作（阻塞）”的区分和联调测试，确保了复杂任务的时序逻辑按预期正确执行。

补充说明：

对于跟廖工侧的平板需求对接，我跟文轩沟通，文轩的意思是他们的app只提供界面，所有的功能由我们定义(9月份的日报有反馈这一点)，当时双臂机器人的功能定义就只有奉工文档中说到的几个功能(关节运动，直线运动，点动等)，gui侧的双臂还在等待联调中，就没有推动文轩侧把这几个功能做到平板app里面了。